<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mobile ASCII Rogue</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="info">Level: 1 | HP: 10 | Hunger: 100 | Sword: ✗</div>
<pre id="game"></pre>

<div id="inventory">
  <button onclick="usePotion()">Use Potion</button>
  <button onclick="equipSword()">Equip Sword</button>
  <button onclick="eatFood()">Eat Food</button>
</div>

<div id="dpad">
  <button onclick="move(0, -1)">↑</button>
  <div>
    <button onclick="move(-1, 0)">←</button>
    <button onclick="move(1, 0)">→</button>
  </div>
  <button onclick="move(0, 1)">↓</button>
</div>

<script>
  let W, H;
  let map = [], rooms = [], enemies = [], items = [];
  let player = {x:0,y:0,hp:10,hunger:100,inv:[],sword:false};
  let stairs, level=1;

  function rand(a,b){ return a + Math.floor(Math.random()*(b-a+1)); }

  function calculateMapSize() {
    // These values might need tweaking based on actual font size and screen real estate
    const charWidthEstimate = 0.035 * window.innerWidth; // Assuming 3.5vw font size
    const charHeightEstimate = 0.05 * window.innerHeight; // A rough estimate for line height

    W = Math.floor(window.innerWidth / charWidthEstimate);
    H = Math.floor((window.innerHeight * 0.7) / charHeightEstimate); // Use about 70% of height for the map
    if (W < 20) W = 20; // Minimum width
    if (H < 15) H = 15; // Minimum height
  }

  function initGame() {
    calculateMapSize();
    // (You'd have your map generation, room creation, enemy placement here)
    // For now, let's just create a simple map
    map = Array(H).fill(0).map(() => Array(W).fill('#')); // Fill with walls
    // Place player in a random spot (for demonstration)
    player.x = rand(1, W - 2);
    player.y = rand(1, H - 2);
    map[player.y][player.x] = '@'; // Player character
    updateDisplay();
    updateInfo();
  }

  function updateDisplay() {
    let displayMap = map.map(row => [...row]); // Create a copy to modify for display
    displayMap[player.y][player.x] = '@'; // Ensure player is drawn

    // Draw enemies (simple example)
    enemies.forEach(e => {
      if (e.hp > 0) {
        displayMap[e.y][e.x] = 'E'; // Example enemy char
      }
    });

    // Draw items (simple example)
    items.forEach(item => {
      displayMap[item.y][item.x] = item.char; // Example item char (e.g., 'P' for potion)
    });


    // Center the map in the display
    let gameDiv = document.getElementById('game');
    let mapString = displayMap.map(row => row.join('')).join('\n');
    gameDiv.textContent = mapString;
  }

  function updateInfo() {
    let infoDiv = document.getElementById('info');
    infoDiv.textContent = `Level: ${level} | HP: ${player.hp} | Hunger: ${player.hunger} | Sword: ${player.sword ? '✓' : '✗'}`;
  }

  function move(dx, dy) {
    let newX = player.x + dx;
    let newY = player.y + dy;

    // Basic boundary and wall collision
    if (newX >= 0 && newX < W && newY >= 0 && newY < H && map[newY][newX] !== '#') {
      player.x = newX;
      player.y = newY;
      // You'd add logic here for:
      // - Picking up items
      // - Attacking enemies
      // - Going down stairs
      // - Hunger reduction
      // - Enemy movement
      // - Etc.
      updateDisplay();
      updateInfo();
    }
  }

  function usePotion() {
    alert("Using a potion! (Logic to be implemented)");
    // Example: player.hp = Math.min(10, player.hp + 5);
    updateInfo();
  }

  function equipSword() {
    player.sword = !player.sword; // Toggle sword
    alert(`Sword ${player.sword ? 'equipped' : 'unequipped'}!`);
    updateInfo();
  }

  function eatFood() {
    alert("Eating food! (Logic to be implemented)");
    // Example: player.hunger = Math.min(100, player.hunger + 20);
    updateInfo();
  }

  // Initialize the game when the page loads
  window.onload = initGame;
  window.onresize = initGame; // Recalculate map size on resize
</script>
</body>
</html>
